{% extends "layout/content.html" %}
{% load i18n %}

{% block title %}{% translate "Collaborateurs" %}{{ block.super }}{% endblock %}

{% block content %}

<h1>{% translate "Collaborateurs" %}</h1>

<h2 class="text-muted">
    {{ organization.display_name }}
</h2>

<div class="alert alert-info" role="alert">
    {% translate "Vous êtes connecté en tant que " %}<b>{{ user.first_name }} {{ user.last_name }}</b> ({{ user.email }})
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">{% translate "Nom" %}</th>
                <th scope="col">{% translate "Email" %}</th>
                <th scope="col">{% translate "Date d'inscription" %}</th>
                {% if user in organization.active_admin_members %}
                    <th scope="col">{% translate "Actions" %}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for member in members %}
                <tr>
                    <th scope="row">{{ forloop.counter }}</th>
                    <td>
                        {{ member.user.get_full_name }}
                        {% if member.user in organization.active_admin_members %}
                            <span class="badge badge-info" data-toggle="tooltip" title="{% translate "Administrateur de la structure"%}">
                                {% translate "admin" %}                            
                            </span>
                        {% endif %}
                    </td>
                    <td><a href="mailto:{{ member.user.email }}">{{ member.user.email }}</a></td>
                    <td>{{ member.joined_at|date:"d F Y à H:i" }}</td>
                    {% if user in organization.active_admin_members %}
                        <td>
                            <div class="text-center">
                                {% if member.user != user and user in organization.active_admin_members %}
                                    <a href="{% url "prescribers_views:deactivate_member" member.user.pk %}" role="button">
                                        {% translate "Retirer de la structure" %}
                                    </a>
                                {% else %}
                                    {% include "includes/icon.html" with icon="slash" %}
                                {% endif %}
                            </div>
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function _updateForm(form, mpk) { $(form).attr('action', 'toggle_membership/' + mpk); }
</script>

<div class="modal fade" id="deactivateModal" tabindex="-1" aria-labelledby="deactivateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% translate "Désactiver un utilisateur" %}</h5>
            </div>
            <div class="modal-body">
                {% translate "Vous allez retirer cet utilisateur des membres de votre structure." %}<br>
            </div>
            <div class="modal-footer">
                <form id="deactivation_confirm_form" action="" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">{% translate "Désactiver l'utilisateur" %}</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">{% translate "Annuler" %}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<a href="{% url 'invitations_views:invite_prescriber_with_org' %}" class="align-self-center">
    <button class="btn btn-primary mb-1 w-100 w-sm-auto mt-2">{% translate "Inviter des collaborateurs" %}</button>
</a>

{% if pending_invitations %}
    {% include "invitations_views/includes/pending_invitations.html" %}
{% endif %}

{% endblock %}
