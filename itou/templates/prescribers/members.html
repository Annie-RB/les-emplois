{% extends "layout/content.html" %}
{% load i18n %}

{% block title %}{% translate "Collaborateurs" %}{{ block.super }}{% endblock %}

{% block content %}

<h1>{% translate "Collaborateurs" %}</h1>

<h2 class="text-muted">
    {{ organization.display_name }}
</h2>

<div class="alert alert-info" role="alert">
    {% translate "Vous êtes connecté en tant que" %} <b>{{ user.get_full_name }}</b> ({{ user.email }})
</div>

{% with active_admin_members=organization.active_admin_members %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">{% translate "Nom" %}</th>
                    <th scope="col">{% translate "Email" %}</th>
                    <th scope="col">{% translate "Date d'inscription" %}</th>
                    {% if user in active_admin_members %}
                        <th scope="col">{% translate "Actions" %}</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for member in members %}
                    <tr>
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>
                            {{ member.user.get_full_name }}
                            {% if member.user in active_admin_members %}
                                <span class="badge badge-info" data-toggle="tooltip" title="{% translate "Administrateur de la structure"%}">
                                    {% translate "admin" %}                            
                                </span>
                            {% endif %}
                        </td>
                        <td><a href="mailto:{{ member.user.email }}">{{ member.user.email }}</a></td>
                        <td>{{ member.joined_at|date:"d F Y à H:i" }}</td>
                        {% if user in active_admin_members %}
                            <td>
                                <div>
                                    {% if member.user != user %}
                                        <a href="{% url "prescribers_views:deactivate_member" member.user.pk %}" role="button">
                                            {% translate "Retirer de la structure" %}
                                        </a>
                                        <br>
                                        {% if not member.is_admin %}
                                            <a href="{% url "prescribers_views:update_admin_role" "add" member.user.pk %}" role="button">
                                                Ajouter en tant qu'administrateur
                                            </a>
                                        {% else %}
                                            <a href="{% url "prescribers_views:update_admin_role" "remove" member.user.pk %}" role="button">
                                                Retirer les droits d'administrateur
                                            </a>
                                        {% endif %}
                                    {% else %}
                                        <div class="text-center">
                                            {% include "includes/icon.html" with icon="slash" %}
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endwith %}

<a href="{% url 'invitations_views:invite_prescriber_with_org' %}" class="align-self-center">
    <button class="btn btn-primary mb-1 w-100 w-sm-auto mt-2">{% translate "Inviter des collaborateurs" %}</button>
</a>

{% if pending_invitations %}
    {% include "invitations_views/includes/pending_invitations.html" %}
{% endif %}

{% endblock %}
