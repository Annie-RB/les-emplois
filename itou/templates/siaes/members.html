{% extends "layout/content.html" %}
{% load i18n %}

{% block title %}{% translate "Collaborateurs" %}{{ block.super }}{% endblock %}


{% block content %}

<div class="d-sm-inline-flex mb-3 align-items-sm-baseline">
    <h1>{% translate "Collaborateurs" %}</h1>
    <h2 class="text-muted ml-sm-4">{{ siae.display_name }}</h2>
</div>

<div class="alert alert-info" role="alert">
    {% translate "Vous êtes connecté en tant que " %}<b>{{ user.first_name }} {{ user.last_name }}</b> ({{ user.email }})
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">{% translate "Nom" %}</th>
                <th scope="col">{% translate "Email" %}</th>
                <th scope="col">{% translate "Date d'inscription" %}</th>
                {% if user in siae.active_admin_members %}
                    <th scope="col">{% translate "Action" %}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for member in members %}
                <tr>
                    <th scope="row">{{ forloop.counter }}</th>
                    <td>
                        {{ member.user.get_full_name }}
                        {% if member.user in siae.active_admin_members %}
                            <span class="badge badge-info" data-toggle="tooltip" title="{% translate "Administrateur de la structure"%}">
                                {% translate "admin" %}                            
                            </span>
                        {% endif %}
                    </td>
                    <td><a href="mailto:{{ member.user.email }}">{{ member.user.email }}</a></td>
                    <td>{{ member.joined_at|date:"d F Y à H:i" }}</td>
                    {% if user in siae.active_admin_members %}
                        <td>
                            <div>
                                {% if member.user != user and user in siae.active_admin_members %}
                                    <a href="{% url "siaes_views:deactivate_member" member.user.pk %}" role="button">
                                        {% translate "Retirer de la structure" %}
                                    </a>
                                    <br>
                                    {% if not member.is_siae_admin %}
                                    <a href="{% url "siaes_views:update_admin_role" "add" member.user.pk %}" role="button">
                                            Ajouter en tant qu'administrateur
                                        </a>
                                    {% else %}
                                    <a href="{% url "siaes_views:update_admin_role" "remove" member.user.pk %}" role="button">
                                            Retirer les droits d'administrateur
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <div class="text-center">
                                        {% include "includes/icon.html" with icon="slash" %}
                                    </div>
                                {% endif %}
                            </div>
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<a href="{% url 'invitations_views:invite_siae_staff' %}" class="align-self-center">
    <button class="btn btn-primary mb-1 w-100 w-sm-auto mt-2">{% translate "Inviter des collaborateurs" %}</button>
</a>

{% if pending_invitations %}
    {% include "invitations_views/includes/pending_invitations.html" %}
{% endif %}

{% endblock %}
